<!DOCTYPE html>
<html lang="en">
<head>
	<title>Modules</title>
	<% include ../partials/head %>
	<script>
		page = "modules";
	</script>
</head>
<body>
	<% include ../partials/nav %>
	<div class="container">
		<h1>Modules</h1>
		<div id="modules">
			<% modules.forEach((module) => { %>
			<div onclick="deleteModule('<%- module.name.replace(' ','%20') %>')();" id=<%- module.name.replace(' ','%20') %> class="module <%= module.state %>">
				<div class="mod-content">
					<h3 class="mod-name"><%= module.name %></h3>
					<p class="mod-meta">
						<span class="mod-state"><%= module.state %></span>
						<span class="mod-urgency"><%= module.urgency %></span>
					</p>
					<p class="mod-text"><%= module.text %></p>
					<% if (module.value !== "" && module.value !== 0) { %>
					<div class="progress-bar">
						<div class="mod-progress" style="width: <%= module.value %>%;">
							<span class="mod-value"><%= module.value %></span>
							<div class="value-overlay"></div>
						</div>
					</div>
					<% } %>
				</div>
				<div class="mod-cover"></div>
			</div>
			<% }) %>
		</div>
	</div>
	<script>

		function deleteModule(id) {
			return function() {
				var pretty = id.replace('%20', ' ');
				if (confirm("Are you sure you want to delete the module '" + pretty + "'?")) {
					sendRequest("/api/modules/" + id, "DELETE", undefined, function(res, err) {
						if (err) {
							alert(err);
						} else {
							window.location.reload();
						}
					});
				}
			}
		}
	</script>
</body>
</html>
